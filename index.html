<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Healthy Brunch Club Wien | Exklusiver Bio-Brunch</title>
    <meta name="description" content="Erleben Sie gehobene Bio-Küche in stilvollem Ambiente. Jeden Montag exklusiver Brunch mit regionalen Zutaten und Live-Musik.">
    <meta name="keywords" content="healthy brunch wien, bio restaurant, fine dining, gumpendorfer straße, vegetarisch vegan wien">
    <meta name="author" content="Healthy Brunch Club">
    <link rel="canonical" href="https://healthybrunchclub.at/">
    
    <!-- Theme Color for Mobile Browsers -->
    <meta name="theme-color" content="#1A1A1A">
    
    <!-- Refined Typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,300;0,400;0,500;0,700;1,400&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,400&family=Montserrat:wght@300;400;500;600&family=Lato:wght@300;400&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Styles -->
    <link rel="stylesheet" href="mystyle-premium.css">
    
    <!-- Mobile Specific Inline Styles -->
    <style>
        .mobile-pdf-download {
            display: none;
            background: #1A1A1A !important;
            color: #FFFFFF !important;
            border: none !important;
            padding: 0.75rem 1.5rem !important;
            border-radius: 25px !important;
            font-family: 'Montserrat', sans-serif !important;
            font-size: 0.75rem !important;
            font-weight: 500 !important;
            text-transform: uppercase !important;
            letter-spacing: 0.1em !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
            margin: 0 auto 2rem !important;
            gap: 0.5rem !important;
            align-items: center !important;
            justify-content: center !important;
            -webkit-appearance: none !important;
            -moz-appearance: none !important;
            appearance: none !important;
        }

        @media (max-width: 768px) {
            .mobile-pdf-download {
                display: flex !important;
            }
        }

        .mobile-pdf-download:active {
            transform: scale(0.95) !important;
            background: #C9A961 !important;
        }

        /* iOS Safari Specific Fixes */
        @supports (-webkit-touch-callout: none) {
            .mobile-pdf-download {
                -webkit-tap-highlight-color: transparent;
                touch-action: manipulation;
            }
        }

        /* Fix für iOS Zoom */
        @media (max-width: 768px) {
            input, select, textarea, button {
                font-size: 16px !important;
            }
        }

        /* No transition class for initial load */
        body.no-transition,
        body.no-transition * {
            transition: none !important;
        }
    </style>
    
    <!-- Netlify Identity -->
    <script type="text/javascript" src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
<script src="force-lowercase.js"></script>


    <!-- PWA -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Healthy Brunch Club Wien | Exklusiver Bio-Brunch">
    <meta property="og:description" content="Gehobene Bio-Küche in stilvollem Ambiente">
    <meta property="og:image" content="/og-image.jpg">
    <meta property="og:type" content="restaurant">
</head>

<body class="no-transition">
    <!-- Elegant Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <img src="content/images/logo.png" alt="Healthy Brunch Club" class="loading-logo">
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
            <p class="loading-text">preparing your experience...</p>
        </div>
    </div>

    <!-- Premium Navigation -->
    <nav class="nav-premium" id="navbar">
        <div class="nav-container">
            <a href="#home" class="logo-premium">
                <img src="content/images/logo.png" alt="Healthy Brunch Club" class="logo-img">
            </a>
            
            <ul class="nav-menu">
                <li><a href="#home" class="nav-link">home</a></li>
                <li><a href="#menu" class="nav-link">speisekarte</a></li>
                <li><a href="#about" class="nav-link">über uns</a></li>
                <li><a href="#reservierung" class="nav-link nav-cta">reservierung</a></li>
            </ul>
            
            <button class="mobile-menu-btn" aria-label="Menu" type="button">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-premium" id="home">
        <div class="hero-video-container">
            <video class="hero-video" autoplay muted loop playsinline>
                <source src="/content/videos/healthybrunchclub.mp4" type="video/mp4">
            </video>
            <div class="hero-overlay"></div>
        </div>
        
        <div class="hero-content">
            <h1 class="hero-title">
                <span class="hero-subtitle">willkommen im</span>
                <img src="content/images/logo.png" alt="Healthy Brunch Club" class="main-logo">
                <span class="hero-tagline">where wellness meets culinary excellence</span>
            </h1>
            
            <div class="hero-actions">
                <a href="#menu" class="btn-luxury btn-primary">speisekarte entdecken</a>
                <a href="#reservierung" class="btn-luxury btn-secondary">tisch reservieren</a>
            </div>
        </div>
        
        <div class="scroll-indicator">
            <div class="scroll-arrow"></div>
        </div>
    </section>

    <!-- Premium Menu Section -->
    <section class="menu-premium" id="menu">
        <div class="menu-intro">
            <h2 class="section-title">unsere speisekarte</h2>
            <p class="section-subtitle">eine kulinarische reise durch biologische exzellenz</p>
        </div>

        <!-- Mobile PDF Download Button -->
        <button class="mobile-pdf-download" type="button">
            <i class="fas fa-download"></i>
            <span>speisekarte pdf</span>
        </button>

        <!-- Elegant Minimal Filter System -->
        <div class="menu-filter-container">
            <div class="filter-bar">
                <!-- Category Filters Row -->
                <div class="filter-group">
                    <div class="filter-buttons" id="categoryFilters">
                        <button class="filter-btn active" data-filter="all">
                            <span class="btn-text">alle gerichte</span>
                        </button>
                    </div>
                </div>
                
                <!-- Tags and Actions Row -->
                <div class="filter-row-bottom">
                    <div class="filter-tags desktop-only" id="tagFilters">
                        <!-- Tag filters will be populated dynamically -->
                    </div>
                    
                    <div class="filter-actions">
                        <button class="btn-icon" onclick="resetFilters()" type="button">
                            <i class="fas fa-undo"></i>
                            <span class="btn-text">zurücksetzen</span>
                        </button>
                        <button class="btn-icon" onclick="window.location.href='content/menu.pdf'" type="button">
                            <i class="fas fa-download"></i>
                            <span class="btn-text">pdf</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Menu Content -->
        <div class="menu-content" id="menuContainer">
            <div class="menu-loading">
                <i class="fas fa-spinner fa-spin"></i>
                <p>speisekarte wird geladen...</p>
            </div>
        </div>

        <!-- Allergen Legend -->
        <div class="allergen-info" id="allergenLegend" style="display: none;">
            <h4 class="allergen-title">allergeninformationen</h4>
            <div class="allergen-grid">
                <!-- Allergens will be added dynamically -->
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section class="about-premium" id="about">
        <div class="about-container">
            <div class="about-content">
                <h2 class="section-title">unsere geschichte</h2>
                <p class="about-lead">
                    was einst als einfaches geburtstagsritual begann, lebt heute in unserem brunchlokal weiter.
                </p>
                <p>
                    drei schwestern – eine ärztin und zwei flugbegleiterinnen – vereint durch die liebe zum reisen, zur familie und natürlich: zum brunchen. ob in new york, chicago, an der amalfiküste oder ganz klassisch in unserer heimatstadt wien – das gemeinsame brunchen war immer ein besonderer moment. und mit jedem bissen, jedem kaffee und jeder neuen idee wuchs auch der wunsch, diesen genuss zu teilen.
                </p>
                <p>
                    unsere wurzeln liegen auf den philippinen – und mit ihnen eine tiefe verbundenheit zu gastfreundschaft, aromenvielfalt und dem herz für gutes essen. diese einflüsse spiegeln sich heute in unserer speisekarte genauso wider wie die erfahrungen aus aller welt.
                </p>
                <p>
                    als bei tina eine chronische darmentzündung diagnostiziert wurde, wurde das thema ernährung für uns noch bedeutungsvoller. seither setzen wir gezielt auf gesunde alternativen und entzündungshemmende zutaten – ohne auf geschmack oder kreativität zu verzichten.
                </p>
                <p>
                    das ergebnis: eine bunte auswahl an trendigen, ausgewogenen und international inspirierten brunchgerichten, die nicht nur sättigen, sondern glücklich machen.
                </p>
                <p class="about-cta">
                    kommt vorbei, bruncht mit uns!
                </p>
            </div>
            <div class="about-image">
                <img src="content/images/p38.png" alt="Die Gründerinnen" class="founder-image">
                <div class="image-caption">die drei schwestern – vereint in ihrer vision</div>
            </div>
        </div>
    </section>

    <!-- Reservation Section -->
    <section id="reservierung" class="section-padding elegant-section">
      <div class="container">
        <h2 class="section-title">Reservierung</h2>
        <p class="section-subtitle">Wählen Sie Ihr gewünschtes Datum</p>

        <div id="reservation-container">
          <!-- Step 1: Date Selection -->
          <div id="date-selection" class="reservation-step active">
            <h3 class="step-title">Verfügbare Termine</h3>
            <div id="available-dates-container" class="dates-grid">
              <div class="loading-spinner">Lade verfügbare Termine...</div>
            </div>
          </div>

          <!-- Step 2: Time Selection -->
          <div id="time-selection" class="reservation-step" style="display: none;">
            <h3 class="step-title">Wählen Sie eine Uhrzeit</h3>
            <button class="back-button" onclick="goBackToDateSelection()">← Zurück zur Datumsauswahl</button>
            <div id="timeSlots" class="time-slots-grid">
              <!-- Time slots will be populated here -->
            </div>
          </div>

          <!-- Step 3: Guest Details Form -->
          <div id="guest-details" class="reservation-step" style="display: none;">
            <h3 class="step-title">Ihre Angaben</h3>
            <button class="back-button" onclick="goBackToTimeSelection()">← Zurück zur Zeitauswahl</button>

            <form id="reservation-form" class="elegant-form">
              <div class="form-group">
                <label for="guest-name">Name *</label>
                <input type="text" id="guest-name" required>
              </div>

              <div class="form-group">
                <label for="guest-email">E-Mail *</label>
                <input type="email" id="guest-email" required>
              </div>

              <div class="form-group">
                <label for="guest-phone"><span class="optional-label">Telefon</span></label>
                <input
                  type="tel"
                  id="guest-phone"
                  pattern="[0-9+\-\s]+"
                  placeholder="+43 123 456 7890 (optional)"
                >
              </div>

              <div class="form-group">
                <label for="guestCount">Anzahl Personen *</label>
                <select id="guestCount" required>
                  <option value="">Bitte wählen</option>
                  <option value="1">1 Person</option>
                  <option value="2">2 Personen</option>
                  <option value="3">3 Personen</option>
                  <option value="4">4 Personen</option>
                  <option value="5">5 Personen</option>
                  <option value="6">6 Personen</option>
                  <option value="7">7 Personen</option>
                  <option value="8">8+ Personen</option>
                </select>
              </div>

              <div class="form-group">
                <label for="guest-notes">Besondere Wünsche</label>
                <textarea id="guest-notes" rows="3"></textarea>
              </div>

              <input type="hidden" id="reservationDate">
              <input type="hidden" id="selectedTime">

              <button type="submit" class="submit-button">Reservierung abschicken</button>
            </form>
          </div>

          <!-- Success Message -->
          <div id="reservation-success" class="reservation-step" style="display: none;">
            <div class="success-message">
              <h3>✓ Reservierung erfolgreich!</h3>
              <p id="success-message">Vielen Dank! Ihre Reservierung wurde bestätigt.</p>
              <p>Eine Bestätigung wurde an Ihre E-Mail-Adresse gesendet.</p>
              <button onclick="resetReservation()" class="reset-button">Neue Reservierung</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Premium Footer -->
    <footer class="footer-premium">
        <div class="footer-content">
            <div class="footer-section">
                <img src="content/images/logo.png" alt="Healthy Brunch Club" class="footer-logo">
                <p class="footer-tagline">where wellness meets culinary excellence</p>
                <div class="social-links">
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
                    <a href="#" aria-label="Pinterest"><i class="fab fa-pinterest"></i></a>
                </div>
            </div>
            
            <div class="footer-section">
                <h4>kontakt</h4>
                <address>
                    gumpendorfer straße 9<br>
                    1060 wien<br>
                    <a href="mailto:hello@healthybrunchclub.at">hello@healthybrunchclub.at</a>
                </address>
            </div>
            
            <div class="footer-section">
                <h4>newsletter</h4>
                <p>exklusive einblicke und events</p>
                <form name="newsletter" method="POST" data-netlify="true" class="newsletter-form">
                    <input type="hidden" name="form-name" value="newsletter">
                    <input type="email" name="email" placeholder="ihre e-mail" required>
                    <button type="submit" class="btn-newsletter">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </form>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>&copy; 2025 healthy brunch club wien. all rights reserved.</p>
            <p>
                <a href="/impressum">impressum</a> | 
                <a href="/datenschutz">datenschutz</a> | 
                <a href="/agb">agb</a>
            </p>
        </div>
    </footer>

    <!-- Admin Button -->
    <a href="/admin" class="admin-btn" id="adminBtn">
        <i class="fas fa-edit"></i>
    </a>

    <!-- Event Window -->
    <div class="event-window" id="eventWindow" style="display: none;">
        <button class="event-toggle" onclick="toggleEventWindow()" type="button">
            <i class="fas fa-music"></i>
        </button>
        <div class="event-content" id="eventContent"></div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="cms-loader-premium.js"></script>
    <script src="app-premium.js"></script>
    <script>
    // Reservation System
    let selectedDate = null;
    let selectedTime = null;

    document.addEventListener('DOMContentLoaded', () => {
      if (document.getElementById('available-dates-container')) {
        loadAvailableDates();
      }

      const reservationForm = document.getElementById('reservation-form');
      if (reservationForm) {
        reservationForm.addEventListener('submit', handleReservationSubmit);
      }

      const guestCountInput = document.getElementById('guestCount');
      if (guestCountInput) {
        guestCountInput.addEventListener('change', () => {
          const guests = parseInt(guestCountInput.value, 10);
          if (selectedDate?.date && selectedTime && !Number.isNaN(guests)) {
            checkSlotCapacity(selectedTime, guests);
          }
        });
      }
    });

    async function loadAvailableDates() {
      const container = document.getElementById('available-dates-container');

      try {
        const response = await fetch('/.netlify/functions/get-available-dates');
        if (!response.ok) {
          throw new Error('Netzwerkantwort war nicht ok');
        }
        const data = await response.json();

        if (data.availableDates && data.availableDates.length > 0) {
          displayAvailableDates(data.availableDates);
        } else {
          container.innerHTML = '<p class="no-dates">Derzeit sind keine Termine verfügbar. Bitte kontaktieren Sie uns telefonisch.</p>';
        }
      } catch (error) {
        console.error('Error loading dates:', error);
        container.innerHTML = '<p class="error-message">Fehler beim Laden der Termine. Bitte versuchen Sie es später erneut.</p>';
      }
    }

    function displayAvailableDates(dates) {
      const container = document.getElementById('available-dates-container');
      container.innerHTML = '';

      dates.forEach((dateData) => {
        const date = new Date(dateData.date);
        const dayNum = date.getDate();
        const month = date.toLocaleDateString('de-DE', { month: 'long' });
        const weekday = date.toLocaleDateString('de-DE', { weekday: 'long' });

        const card = document.createElement('button');
        card.type = 'button';
        card.className = 'date-card';
        card.innerHTML = `
          <h4>${weekday}</h4>
          <span class="date-day">${dayNum}</span>
          <span class="date-month">${month}</span>
          ${dateData.note ? `<div class="date-note">${dateData.note}</div>` : ''}
        `;
        card.addEventListener('click', () => selectDate(dateData, card));

        container.appendChild(card);
      });
    }

    function selectDate(dateData, card) {
      selectedDate = dateData;
      selectedTime = null;

      const dateInput = document.getElementById('reservationDate');
      if (dateInput) {
        dateInput.value = dateData.date;
      }

      const timeInput = document.getElementById('selectedTime');
      if (timeInput) {
        timeInput.value = '';
      }

      document.querySelectorAll('.date-card').forEach((el) => el.classList.remove('selected'));
      card.classList.add('selected');

      const dateSelection = document.getElementById('date-selection');
      const timeSelection = document.getElementById('time-selection');
      const guestDetails = document.getElementById('guest-details');

      if (dateSelection) {
        dateSelection.style.display = 'none';
      }
      if (timeSelection) {
        timeSelection.style.display = 'block';
      }
      if (guestDetails) {
        guestDetails.style.display = 'none';
      }

      loadAvailableSlots(dateData.date);
    }

    async function loadAvailableSlots(selectedDateValue) {
      const slotsContainer = document.getElementById('timeSlots');
      if (!slotsContainer) {
        return;
      }

      slotsContainer.innerHTML = '<div class="loading">Lade verfügbare Zeiten...</div>';

      try {
        const response = await fetch(`/.netlify/functions/get-availability?date=${selectedDateValue}`);
        const data = await response.json();

        if (!data.slots || data.slots.length === 0) {
          slotsContainer.innerHTML = '<div class="no-slots">Keine Zeiten verfügbar für diesen Tag.</div>';
          return;
        }

        slotsContainer.innerHTML = data.slots
          .map((slot) => {
            const isBlocked = slot.remaining === 0;
            const isNearlyFull = slot.remaining > 0 && slot.remaining < 5;
            const percentageUsed = slot.capacity > 0 ? ((slot.reserved / slot.capacity) * 100).toFixed(0) : 0;

            return `
                <div class="time-slot ${isBlocked ? 'blocked' : ''} ${isNearlyFull ? 'nearly-full' : ''}" 
                     data-time="${slot.time}" 
                     data-available="${!isBlocked}">
                    <div class="slot-time">${slot.time}</div>
                    <div class="slot-availability">
                        ${isBlocked 
                          ? '<span class="badge blocked">Ausgebucht</span>' 
                          : isNearlyFull 
                            ? `<span class="badge warning">Nur noch ${slot.remaining} Plätze</span>`
                            : `<span class="badge available">${slot.remaining} Plätze frei</span>`
                        }
                    </div>
                    <div class="slot-capacity-bar">
                        <div class="capacity-fill" style="width: ${percentageUsed}%"></div>
                    </div>
                    <div class="slot-details">
                        ${slot.reserved}/${slot.capacity} belegt
                    </div>
                </div>
            `;
          })
          .join('');

        document.querySelectorAll('.time-slot[data-available="true"]').forEach((slot) => {
          slot.addEventListener('click', () => {
            selectTimeSlot(slot);
          });
        });
      } catch (error) {
        console.error('Fehler beim Laden der Slots:', error);
        slotsContainer.innerHTML = '<div class="error">Fehler beim Laden der verfügbaren Zeiten.</div>';
      }
    }

    async function selectTimeSlot(slotElement) {
      if (slotElement.dataset.available === 'false') {
        showNotification('Dieser Zeitslot ist bereits ausgebucht.', 'error');
        return;
      }

      document.querySelectorAll('.time-slot.selected').forEach((el) => {
        el.classList.remove('selected');
      });

      slotElement.classList.add('selected');

      selectedTime = slotElement.dataset.time;

      const timeInput = document.getElementById('selectedTime');
      if (timeInput) {
        timeInput.value = selectedTime;
      }

      const guestCountInput = document.getElementById('guestCount');
      const guestCount = parseInt(guestCountInput?.value, 10) || 1;

      await checkSlotCapacity(selectedTime, guestCount);

      const timeSelection = document.getElementById('time-selection');
      const guestDetails = document.getElementById('guest-details');

      if (timeSelection && guestDetails) {
        timeSelection.style.display = 'none';
        guestDetails.style.display = 'block';
      }

      updateFormSummary();
    }

    async function checkSlotCapacity(time, guests) {
      const dateInput = document.getElementById('reservationDate');
      const date = dateInput?.value;
      if (!date) {
        return;
      }

      try {
        const response = await fetch(`/.netlify/functions/get-availability?date=${date}&guests=${guests}`);
        const data = await response.json();

        const slot = data.slots?.find((entry) => entry.time === time);
        const submitButton = document.querySelector('.submit-button');

        if (slot && !slot.fits) {
          showNotification(`Nicht genug Plätze für ${guests} Gäste um ${time}. Nur ${slot.remaining} Plätze verfügbar.`, 'warning');
          if (submitButton) {
            submitButton.disabled = true;
          }
        } else if (submitButton) {
          submitButton.disabled = false;
        }
      } catch (error) {
        console.error('Kapazitätsprüfung fehlgeschlagen:', error);
      }
    }

    function showNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);

      setTimeout(() => {
        notification.remove();
      }, 3000);
    }

    function updateFormSummary() {
      if (!selectedDate || !selectedTime) return;

      const date = new Date(selectedDate.date);
      const dateStr = date.toLocaleDateString('de-DE', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });

      const formTitle = document.querySelector('#guest-details .step-title');
      if (formTitle) {
        formTitle.innerHTML = `
          Ihre Angaben<br>
          <small style="font-size: 0.8em; opacity: 0.8;">
            ${dateStr} um ${selectedTime} Uhr
          </small>
        `;
      }
    }

    function goBackToDateSelection() {
      const dateSelection = document.getElementById('date-selection');
      const timeSelection = document.getElementById('time-selection');
      const guestDetails = document.getElementById('guest-details');
      const submitButton = document.querySelector('.submit-button');
      const timeInput = document.getElementById('selectedTime');

      if (timeSelection) {
        timeSelection.style.display = 'none';
      }
      if (guestDetails) {
        guestDetails.style.display = 'none';
      }
      if (dateSelection) {
        dateSelection.style.display = 'block';
      }

      selectedTime = null;

      if (timeInput) {
        timeInput.value = '';
      }

      if (submitButton) {
        submitButton.disabled = false;
      }

      document.querySelectorAll('.time-slot').forEach((el) => el.classList.remove('selected'));
    }

    function goBackToTimeSelection() {
      const guestDetails = document.getElementById('guest-details');
      const timeSelection = document.getElementById('time-selection');
      const submitButton = document.querySelector('.submit-button');
      const timeInput = document.getElementById('selectedTime');

      if (guestDetails) {
        guestDetails.style.display = 'none';
      }
      if (timeSelection) {
        timeSelection.style.display = 'block';
      }

      selectedTime = null;

      if (timeInput) {
        timeInput.value = '';
      }
      if (submitButton) {
        submitButton.disabled = false;
      }

      if (selectedDate?.date) {
        loadAvailableSlots(selectedDate.date);
      }
    }

    async function handleReservationSubmit(event) {
      event.preventDefault();

      const reservationDateInput = document.getElementById('reservationDate');
      const selectedTimeInput = document.getElementById('selectedTime');
      const reservationDate = reservationDateInput?.value || selectedDate?.date;
      const reservationTime = selectedTimeInput?.value || selectedTime;

      if (!reservationDate || !reservationTime) {
        alert('Bitte wählen Sie Datum und Uhrzeit aus.');
        return;
      }

      const formElement = event.currentTarget;
      const submitButton = formElement.querySelector('button[type="submit"]');
      if (submitButton) {
        submitButton.disabled = true;
        submitButton.textContent = 'Wird gesendet...';
      }

      const formData = {
        date: reservationDate,
        time: reservationTime,
        name: document.getElementById('guest-name').value.trim(),
        email: document.getElementById('guest-email').value.trim(),
        phone: document.getElementById('guest-phone').value.trim(),
        guests: parseInt(document.getElementById('guestCount').value, 10),
        specialRequests: document.getElementById('guest-notes').value.trim(),
        honeypot: ''
      };

      if (!formData.name || !formData.email || Number.isNaN(formData.guests) || formData.guests <= 0) {
        alert('Bitte füllen Sie alle Pflichtfelder aus.');
        if (submitButton) {
          submitButton.disabled = false;
          submitButton.textContent = 'Reservierung abschicken';
        }
        return;
      }

      try {
        const response = await fetch('/.netlify/functions/create-reservation', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });

        const contentType = response.headers.get('content-type') || '';
        let result = {};

        if (contentType.includes('application/json')) {
          result = await response.json();
        } else if (!response.ok) {
          const errorText = await response.text();
          throw new Error(errorText || `Es gab einen Fehler bei Ihrer Reservierung (Status ${response.status}).`);
        }

        if (response.ok) {
          showReservationSuccess(result);
        } else if (response.status === 404) {
          console.warn('Netlify Forms returned 404 but submission was likely successful.');
          showReservationSuccess();
        } else if (result.errors) {
          const errorMessages = Object.values(result.errors).join('\n');
          alert(`Fehler bei der Reservierung:\n${errorMessages}`);
          return;
        } else {
          const errorMessage = result.message || `Es gab einen Fehler bei Ihrer Reservierung (Status ${response.status}).`;
          throw new Error(errorMessage);
        }
      } catch (error) {
        console.error('Reservation submission error:', error);
        if (error.name === 'TypeError' || (typeof error.message === 'string' && error.message.includes('Failed to fetch')) || !navigator.onLine) {
          alert('Netzwerkfehler: Bitte überprüfen Sie Ihre Internetverbindung und versuchen Sie es erneut.');
        } else {
          console.log('Form submission handled by Netlify');
          showReservationSuccess();
        }
      } finally {
        if (submitButton) {
          submitButton.disabled = false;
          submitButton.textContent = 'Reservierung abschicken';
        }
      }
    }

    function showReservationSuccess(result = {}) {
      const guestDetailsStep = document.getElementById('guest-details');
      const successStep = document.getElementById('reservation-success');
      const timeStep = document.getElementById('time-selection');
      const dateStep = document.getElementById('date-selection');

      if (guestDetailsStep) {
        guestDetailsStep.style.display = 'none';
      }
      if (timeStep) {
        timeStep.style.display = 'none';
      }
      if (dateStep) {
        dateStep.style.display = 'none';
      }
      if (successStep) {
        successStep.style.display = 'block';
      }

      const successMessageEl = document.getElementById('success-message');
      if (successMessageEl) {
        successMessageEl.textContent =
          result.message || 'Vielen Dank für Ihre Reservierung! Sie erhalten in Kürze eine Bestätigungs-E-Mail.';
      }

      const confirmationCodeEl = document.getElementById('confirmation-code');
      if (confirmationCodeEl && result.reservation && result.reservation.confirmationCode) {
        confirmationCodeEl.textContent = result.reservation.confirmationCode;
        confirmationCodeEl.style.display = 'block';
      }

      const formElement = document.getElementById('reservation-form');
      if (formElement) {
        formElement.reset();
      }

      selectedDate = null;
      selectedTime = null;
    }

    function resetReservation() {
      selectedDate = null;
      selectedTime = null;

      const reservationForm = document.getElementById('reservation-form');
      if (reservationForm) {
        reservationForm.reset();
      }

      const dateInput = document.getElementById('reservationDate');
      const timeInput = document.getElementById('selectedTime');
      const submitButton = document.querySelector('.submit-button');

      if (dateInput) {
        dateInput.value = '';
      }
      if (timeInput) {
        timeInput.value = '';
      }
      if (submitButton) {
        submitButton.disabled = false;
      }

      document.getElementById('reservation-success').style.display = 'none';
      document.getElementById('guest-details').style.display = 'none';
      document.getElementById('time-selection').style.display = 'none';
      document.getElementById('date-selection').style.display = 'block';

      document.querySelectorAll('.date-card').forEach((el) => el.classList.remove('selected'));
      const stepTitle = document.querySelector('#guest-details .step-title');
      if (stepTitle) {
        stepTitle.textContent = 'Ihre Angaben';
      }

      loadAvailableDates();
    }
    window.goBackToDateSelection = goBackToDateSelection;
    window.goBackToTimeSelection = goBackToTimeSelection;
    window.resetReservation = resetReservation;
    </script>

</body>
</html>
