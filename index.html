<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesunde, darmfreundliche und entz√ºndungshemmende Speisen - Eat well. Feel Better</title>
    <meta name="description" content="Erleben Sie gehobene Bio-K√ºche in stilvollem Ambiente. Jeden Montag exklusiver Brunch mit regionalen Zutaten und Live-Musik.">
    <meta name="keywords" content="healthy brunch wien, bio restaurant, fine dining, gumpendorfer stra√üe, vegetarisch vegan wien">
    <meta name="author" content="Healthy Brunch Club">
    <link rel="canonical" href="https://healthybrunchclub.at/">
    
    <!-- Theme Color for Mobile Browsers -->
    <meta name="theme-color" content="#1A1A1A">
    
    <!-- Preconnect to critical domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>

    <!-- Preload critical assets -->
    <link rel="preload" href="content/images/logo.webp" as="image" type="image/webp">

    <!-- Critical CSS inline for above-the-fold content -->
    <style>
        /* Critical CSS for initial render */
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--bg-dark:#0a0a0a;--text-light:#f5f5f5;--accent:#c9a55c}
        body{font-family:system-ui,-apple-system,sans-serif;background:var(--bg-dark);color:var(--text-light);overflow-x:hidden}
        .loading-screen{position:fixed;inset:0;background:var(--bg-dark);display:flex;align-items:center;justify-content:center;z-index:10000}
        .loading-content{text-align:center}
        .loading-logo{width:200px;height:auto;animation:pulse 2s ease-in-out infinite}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.7}}
        .loading-bar{width:200px;height:2px;background:rgba(255,255,255,.1);margin:2rem auto;overflow:hidden;border-radius:1px}
        .loading-progress{height:100%;background:var(--accent);animation:loading 2s ease-in-out infinite}
        @keyframes loading{0%{width:0;margin-left:0}50%{width:100%;margin-left:0}100%{width:0;margin-left:100%}}
        .loading-text{font-size:.875rem;letter-spacing:.2em;opacity:.6}
        .nav-premium{position:fixed;top:0;left:0;right:0;z-index:1000;padding:1rem 2rem;transition:all .3s}
        .hero-premium{min-height:100vh;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
        .hero-video-container{position:absolute;inset:0}
        .hero-video{width:100%;height:100%;object-fit:cover}
        .hero-overlay{position:absolute;inset:0;background:linear-gradient(to bottom,rgba(0,0,0,.4),rgba(0,0,0,.7))}
    </style>

    <!-- Main stylesheet - non-blocking -->
    <link rel="preload" href="mystyle-premium.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="mystyle-premium.css"></noscript>

    <!-- Fonts - with display swap for better performance -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,300;0,400;0,500;0,700;1,400&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,400&family=Montserrat:wght@300;400;500;600&family=Lato:wght@300;400&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,300;0,400;0,500;0,700;1,400&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,400&family=Montserrat:wght@300;400;500;600&family=Lato:wght@300;400&display=swap" rel="stylesheet"></noscript>

    <!-- Icons - defer loading -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></noscript>
    
    <!-- Mobile Specific Inline Styles -->
    <style>
        /* Fix f√ºr iOS Zoom */
        @media (max-width: 768px) {
            input, select, textarea, button {
                font-size: 16px !important;
            }
        }

        /* No transition class for initial load */
        body.no-transition,
        body.no-transition * {
            transition: none !important;
        }
    </style>
    
    <!-- Netlify Identity - defer non-critical -->
    <script defer src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script defer src="force-lowercase.js"></script>


    <!-- PWA -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Gesunde, darmfreundliche und entz√ºndungshemmende Speisen - Eat well. Feel Better">
    <meta property="og:description" content="Gehobene Bio-K√ºche in stilvollem Ambiente">
    <meta property="og:image" content="/og-image.jpg">
    <meta property="og:type" content="restaurant">
</head>

<body class="no-transition">
    <!-- Elegant Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <picture>
                <source srcset="content/images/logo.webp" type="image/webp">
                <img src="content/images/logo.png" alt="Healthy Brunch Club" class="loading-logo" width="200" height="90" fetchpriority="high">
            </picture>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
            <p class="loading-text">preparing your experience...</p>
        </div>
    </div>

    <!-- Premium Navigation -->
    <nav class="nav-premium" id="navbar">
        <div class="nav-container">
            <a href="#home" class="logo-premium">
                <picture>
                    <source srcset="content/images/logo.webp" type="image/webp">
                    <img src="content/images/logo.png" alt="Healthy Brunch Club" class="logo-img" width="140" height="63">
                </picture>
            </a>
            
            <ul class="nav-menu">
                <li><a href="#home" class="nav-link">home</a></li>
                <li><a href="#menu" class="nav-link">speisekarte</a></li>
                <li><a href="#about" class="nav-link">√ºber uns</a></li>
                <li><a href="/partner" class="nav-link">partner</a></li>
                <li><a href="#reservierung" class="nav-link nav-cta">reservierung</a></li>
                <li><button class="nav-info-btn" onclick="openInfoModal()" type="button" aria-label="Informationen"><i class="fas fa-info-circle"></i></button></li>
                <li><a href="/admin" class="nav-admin-btn" id="adminBtn" aria-label="Admin"><i class="fas fa-user-shield"></i></a></li>
            </ul>
            
            <button class="mobile-menu-btn" aria-label="Menu" type="button">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-premium" id="home">
        <div class="hero-video-container">
            <video class="hero-video" autoplay muted loop playsinline preload="metadata" poster="content/images/dsc00153_ergebnis.webp">
                <source src="/content/videos/healthybrunchclub.mp4" type="video/mp4">
            </video>
            <div class="hero-overlay"></div>
        </div>
        
        <div class="hero-content">
            <h1 class="hero-title">
                <span class="hero-subtitle">willkommen</span>
                <picture>
                    <source srcset="content/images/logo-400w.webp 400w, content/images/logo-800w.webp 800w, content/images/logo.webp 1246w" sizes="(max-width: 600px) 280px, (max-width: 900px) 400px, 500px" type="image/webp">
                    <img src="content/images/logo.png" alt="Healthy Brunch Club" class="main-logo" width="500" height="225" loading="eager">
                </picture>
                <span class="hero-tagline">healthy food, elevated brunch</span>
            </h1>
            
            <div class="hero-actions">
                <a href="#menu" class="btn-luxury btn-primary">speisekarte entdecken</a>
                <a href="#reservierung" class="btn-luxury btn-secondary">tisch reservieren</a>
            </div>
        </div>
        
        <div class="scroll-indicator">
            <div class="scroll-arrow"></div>
        </div>
    </section>

    <!-- Premium Menu Section -->
    <section class="menu-premium" id="menu">
        <div class="menu-intro">
            <h2 class="section-title">unsere speisekarte</h2>
            <p class="section-subtitle">mit gutem Gewissen genie√üen</p>
        </div>

        <!-- Personalized Recommendations Section -->
        <div class="recommendations-section" id="recommendationsSection" style="display: none;">
            <div class="recommendations-header">
                <div class="recommendations-title">
                    <span class="sparkle-icon">‚ú®</span>
                    <h3>f√ºr dich empfohlen</h3>
                    <button class="preferences-btn" onclick="openPreferencesModal()" type="button" aria-label="Pr√§ferenzen anpassen">
                        <i class="fas fa-sliders-h"></i>
                    </button>
                </div>
                <p class="recommendations-subtitle" id="recommendationsSubtitle">Basierend auf deinen Vorlieben</p>
            </div>
            <div class="recommendations-carousel" id="recommendationsCarousel">
                <button class="carousel-arrow carousel-arrow-left" onclick="scrollRecommendations('left')" type="button" aria-label="Nach links scrollen">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="recommendations-track" id="recommendationsTrack">
                    <!-- Recommendation cards will be inserted here -->
                </div>
                <button class="carousel-arrow carousel-arrow-right" onclick="scrollRecommendations('right')" type="button" aria-label="Nach rechts scrollen">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>

        <!-- Preferences Modal -->
        <div class="preferences-modal-overlay" id="preferencesModalOverlay" onclick="closePreferencesModal()">
            <div class="preferences-modal" onclick="event.stopPropagation()">
                <button class="preferences-modal-close" onclick="closePreferencesModal()" type="button" aria-label="Schlie√üen">
                    <i class="fas fa-times"></i>
                </button>
                <div class="preferences-modal-content">
                    <h3><i class="fas fa-heart"></i> Deine Pr√§ferenzen</h3>
                    <p class="preferences-intro">Hilf uns, die perfekten Gerichte f√ºr dich zu finden!</p>

                    <div class="preferences-section">
                        <h4>Ern√§hrungsweise</h4>
                        <div class="preferences-options dietary-options">
                            <label class="preference-chip">
                                <input type="checkbox" name="dietary" value="vegetarisch">
                                <span>ü•¨ Vegetarisch</span>
                            </label>
                            <label class="preference-chip">
                                <input type="checkbox" name="dietary" value="glutenfrei">
                                <span>üåæ Glutenfrei</span>
                            </label>
                        </div>
                    </div>

                    <div class="preferences-section">
                        <h4>Dein Ziel</h4>
                        <div class="preferences-options goal-options">
                            <label class="preference-chip goal-chip">
                                <input type="radio" name="goal" value="balanced" checked>
                                <span>‚öñÔ∏è Ausgewogen</span>
                            </label>
                            <label class="preference-chip goal-chip">
                                <input type="radio" name="goal" value="fitness">
                                <span>üí™ Fitness</span>
                            </label>
                            <label class="preference-chip goal-chip">
                                <input type="radio" name="goal" value="wellness">
                                <span>üßò Wellness</span>
                            </label>
                            <label class="preference-chip goal-chip">
                                <input type="radio" name="goal" value="energy">
                                <span>‚ö° Energie</span>
                            </label>
                        </div>
                    </div>

                    <div class="preferences-actions">
                        <button class="btn-save-preferences" onclick="savePreferences()">
                            Empfehlungen aktualisieren
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="pdf-downloads">
            <a href="/content/menu.pdf" download="Healthy-Brunch-Club-Speisekarte.pdf" class="pdf-download-btn">
                üìÑ Speisekarte PDF
            </a>
            <a href="/content/menu-english.pdf" download="Healthy-Brunch-Club-Menu-English.pdf" class="pdf-download-btn">
                üá¨üáß English Menu PDF
            </a>
            <a href="/content/kidsmenu.pdf" download="Healthy-Brunch-Club-Kids-Menu.pdf" class="pdf-download-btn">
                üë∂ Kids Menu PDF
            </a>
        </div>

        <!-- Elegant Minimal Filter System -->
        <div class="menu-filter-container">
            <div class="filter-bar">
                <!-- Category Filters Row -->
                <div class="filter-group">
                    <div class="filter-buttons" id="categoryFilters">
                        <button class="filter-btn active" data-filter="all">
                            <span class="btn-text">alle gerichte</span>
                        </button>
                    </div>
                </div>
                
                <!-- Tags and Actions Row -->
                <div class="filter-row-bottom">
                    <div class="filter-tags desktop-only" id="tagFilters">
                        <!-- Tag filters will be populated dynamically -->
                    </div>
                    
                    <div class="filter-actions">
                        <button class="btn-icon" onclick="resetFilters()" type="button">
                            <i class="fas fa-undo"></i>
                            <span class="btn-text">zur√ºcksetzen</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Menu Content -->
        <div class="menu-content" id="menuContainer">
            <div class="menu-loading">
                <i class="fas fa-spinner fa-spin"></i>
                <p>speisekarte wird geladen...</p>
            </div>
        </div>

        <!-- Allergen Legend -->
        <div class="allergen-info" id="allergenLegend" style="display: none;">
            <h4 class="allergen-title">allergeninformationen</h4>
            <div class="allergen-grid">
                <!-- Allergens will be added dynamically -->
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section class="about-premium" id="about">
        <div class="about-container">
            <div class="about-content">
                <h2 class="section-title">unsere geschichte</h2>
                <p class="about-lead">
                    was einst als einfaches geburtstagsritual begann, lebt heute in unserem brunchlokal weiter.
                </p>
                <p>
                    drei schwestern ‚Äì eine √§rztin und zwei flugbegleiterinnen ‚Äì vereint durch die liebe zum reisen, zur familie und nat√ºrlich: zum brunchen. ob in new york, chicago, an der amalfik√ºste oder ganz klassisch in unserer heimatstadt wien ‚Äì das gemeinsame brunchen war immer ein besonderer moment. und mit jedem bissen, jedem kaffee und jeder neuen idee wuchs auch der wunsch, diesen genuss zu teilen.
                </p>
                <p>
                    unsere wurzeln liegen auf den philippinen ‚Äì und mit ihnen eine tiefe verbundenheit zu gastfreundschaft, aromenvielfalt und dem herz f√ºr gutes essen. diese einfl√ºsse spiegeln sich heute in unserer speisekarte genauso wider wie die erfahrungen aus aller welt.
                </p>
                <p>
                    als bei tina eine chronische darmentz√ºndung diagnostiziert wurde, wurde das thema ern√§hrung f√ºr uns noch bedeutungsvoller. seither setzen wir gezielt auf gesunde alternativen und entz√ºndungshemmende zutaten ‚Äì ohne auf geschmack oder kreativit√§t zu verzichten.
                </p>
                <p>
                    das ergebnis: eine bunte auswahl an trendigen, ausgewogenen und international inspirierten brunchgerichten, die nicht nur s√§ttigen, sondern gl√ºcklich machen.
                </p>
                <p class="about-cta">
                    kommt vorbei, bruncht mit uns!
                </p>
            </div>
            <div class="about-image">
                <picture>
                    <source srcset="content/images/p38-400w.webp 400w, content/images/p38.webp 658w" sizes="(max-width: 768px) 100vw, 400px" type="image/webp">
                    <img src="content/images/p38.png" alt="Die Gr√ºnderinnen" class="founder-image" width="658" height="496" loading="lazy">
                </picture>
                <div class="image-caption">die drei schwestern ‚Äì vereint in ihrer vision</div>
            </div>
        </div>
    </section>

    <!-- Reservation Section -->
    <section id="reservierung" class="section-padding elegant-section">
      <div class="container">
        <h2 class="section-title">Reservierung</h2>
        <p class="section-subtitle">W√§hlen Sie Ihr gew√ºnschtes Datum</p>

        <div id="reservation-container">
          <!-- Step 1: Date Selection -->
          <div id="date-selection" class="reservation-step active">
            <h3 class="step-title">Verf√ºgbare Termine</h3>
            <div id="available-dates-container" class="dates-grid">
              <div class="loading-spinner">Lade verf√ºgbare Termine...</div>
            </div>
          </div>

          <!-- Step 2: Time Selection -->
          <div id="time-selection" class="reservation-step" style="display: none;">
            <h3 class="step-title">W√§hlen Sie eine Uhrzeit</h3>
            <button class="back-button" onclick="goBackToDateSelection()">‚Üê Zur√ºck zur Datumsauswahl</button>
            <div id="time-slots-container" class="time-slots-grid">
              <!-- Time slots will be populated here -->
            </div>
          </div>

          <!-- Step 3: Guest Details Form -->
          <div id="guest-details" class="reservation-step" style="display: none;">
            <h3 class="step-title">Ihre Angaben</h3>
            <button class="back-button" onclick="goBackToTimeSelection()">‚Üê Zur√ºck zur Zeitauswahl</button>

            <form id="reservation-form" class="elegant-form">
              <div class="form-group">
                <label for="guest-name">Name *</label>
                <input type="text" id="guest-name" required>
              </div>

              <div class="form-group">
                <label for="guest-email">E-Mail *</label>
                <input type="email" id="guest-email" required>
              </div>

              <div class="form-group">
                <label for="guest-phone"><span class="optional-label">Telefon</span></label>
                <input
                  type="tel"
                  id="guest-phone"
                  pattern="[0-9+\-\s]+"
                  placeholder="+43 123 456 7890 (optional)"
                >
              </div>

              <div class="form-group">
                <label for="guest-count">Anzahl Personen *</label>
                <select id="guest-count" required>
                  <option value="">Bitte w√§hlen</option>
                  <option value="1">1 Person</option>
                  <option value="2">2 Personen</option>
                  <option value="3">3 Personen</option>
                  <option value="4">4 Personen</option>
                  <option value="5">5 Personen</option>
                  <option value="6">6 Personen</option>
                  <option value="7">7 Personen</option>
                  <option value="8">8+ Personen</option>
                </select>
              </div>

              <div class="form-group">
                <label for="guest-notes">Besondere W√ºnsche</label>
                <textarea id="guest-notes" rows="3"></textarea>
              </div>

              <button type="submit" class="submit-button">Reservierung abschicken</button>
            </form>
          </div>

          <!-- Success Message -->
          <div id="reservation-success" class="reservation-step" style="display: none;">
            <div class="success-message">
              <h3>‚úì Reservierung erfolgreich!</h3>
              <p id="success-message">Vielen Dank! Ihre Reservierung wurde best√§tigt.</p>
              <p>Eine Best√§tigung wurde an Ihre E-Mail-Adresse gesendet.</p>
              <button onclick="resetReservation()" class="reset-button">Neue Reservierung</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Premium Footer -->
    <footer class="footer-premium">
        <div class="footer-content">
            <div class="footer-section">
                <picture>
                    <source srcset="content/images/logo-400w.webp" type="image/webp">
                    <img src="content/images/logo.png" alt="Healthy Brunch Club" class="footer-logo" width="150" height="68" loading="lazy">
                </picture>
                <p class="footer-tagline">healthy food, elevated brunch</p>
                <div class="social-links">
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
                    <a href="#" aria-label="Pinterest"><i class="fab fa-pinterest"></i></a>
                </div>
            </div>
            
            <div class="footer-section">
                <h4>kontakt</h4>
                <address>
                    neubaugasse 15<br>
                    1070 wien<br>
                    <a href="mailto:hello@healthybrunchclub.at">hello@healthybrunchclub.at</a>
                </address>
            </div>
            
            <div class="footer-section">
                <h4>newsletter</h4>
                <p>exklusive einblicke und events</p>
                <form name="newsletter" method="POST" data-netlify="true" class="newsletter-form">
                    <input type="hidden" name="form-name" value="newsletter">
                    <input type="email" name="email" placeholder="ihre e-mail" required>
                    <button type="submit" class="btn-newsletter">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </form>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>&copy; 2025 healthy brunch club wien. all rights reserved.</p>
            <p>
                <a href="/impressum">impressum</a> |
                <a href="/datenschutz">datenschutz</a> |
                <a href="/agb">agb</a> |
                <a href="/partner">partner</a>
            </p>
            <p class="creator-credit">design & programming by <a href="https://www.erwinesener.com" target="_blank" rel="noopener noreferrer">erwin esener</a></p>
        </div>
    </footer>

    <!-- Ask Ava Chatbot -->
    <div class="chatbot-container" id="chatbotContainer">
        <button class="chatbot-toggle" id="chatbotToggle" onclick="toggleChatbot()" type="button" aria-label="Ask Ava Chatbot">
            <i class="fas fa-comment-dots"></i>
            <span class="chatbot-label">Ask Ava</span>
        </button>
        <div class="chatbot-window" id="chatbotWindow">
            <div class="chatbot-header">
                <div class="chatbot-title">
                    <span class="chatbot-avatar">üë©‚Äçüç≥</span>
                    <div>
                        <h4>Ask Ava</h4>
                        <span class="chatbot-subtitle">Deine Food-Expertin</span>
                    </div>
                </div>
                <button class="chatbot-close" onclick="toggleChatbot()" type="button" aria-label="Schlie√üen">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="chatbot-messages" id="chatbotMessages">
                <div class="chat-message bot">
                    <div class="message-content">
                        Hallo! Ich bin Ava üëã Frag mich alles √ºber unsere Speisekarte, Zutaten, N√§hrwerte oder verf√ºgbare Brunch-Termine!
                    </div>
                </div>
            </div>
            <div class="chatbot-input-container">
                <form id="chatbotForm" onsubmit="sendChatMessage(event)">
                    <input type="text" id="chatbotInput" placeholder="Frag mich etwas √ºber unser Essen..." autocomplete="off">
                    <button type="submit" class="chatbot-send" aria-label="Senden">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Info Modal -->
    <div class="info-modal-overlay" id="infoModalOverlay" onclick="closeInfoModal()">
        <div class="info-modal" onclick="event.stopPropagation()">
            <button class="info-modal-close" onclick="closeInfoModal()" type="button" aria-label="Schlie√üen">
                <i class="fas fa-times"></i>
            </button>
            <div class="info-modal-content">
                <h3><i class="fas fa-info-circle"></i> Hinweis</h3>
                <p>
                    Die Inhalte und Informationen auf unserer Speisekarte sowie auf dieser Website basieren auf pers√∂nlichen Erfahrungen, sorgf√§ltiger Recherche und ausgew√§hlten, verl√§sslichen Quellen. Wir legen gro√üen Wert darauf, Informationen verantwortungsbewusst und nach bestem Wissen bereitzustellen.
                </p>
                <p>
                    Dennoch ersetzen diese Inhalte keine individuelle medizinische oder ern√§hrungswissenschaftliche Beratung.
                </p>
            </div>
        </div>
    </div>

    <!-- Scripts - defer for non-blocking load -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script defer src="cms-loader-premium.js"></script>
    <script defer src="app-premium.js"></script>
    <script>
    // Reservation System
    let selectedDate = null;
    let selectedTime = null;

    function formatTimeSlot(time) {
      if (typeof time === 'number' || !Number.isNaN(Number(time))) {
        const totalMinutes = parseInt(time, 10);
        const hours = Math.floor(totalMinutes / 60);
        const minutes = totalMinutes % 60;
        return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
      }
      if (typeof time === 'string' && time.includes(':')) {
        return time;
      }
      return time;
    }

    function formatDisplayTime(time) {
      const formatted = formatTimeSlot(time);
      if (typeof formatted === 'string' && formatted.toLowerCase().includes('uhr')) {
        return formatted;
      }
      return `${formatted} Uhr`;
    }

    document.addEventListener('DOMContentLoaded', () => {
      if (document.getElementById('available-dates-container')) {
        loadAvailableDates();
      }

      const reservationForm = document.getElementById('reservation-form');
      if (reservationForm) {
        reservationForm.addEventListener('submit', handleReservationSubmit);
      }
    });

    async function loadAvailableDates() {
      const container = document.getElementById('available-dates-container');

      try {
        const response = await fetch('/.netlify/functions/get-available-dates');
        if (!response.ok) {
          throw new Error('Netzwerkantwort war nicht ok');
        }
        const data = await response.json();

        if (data.availableDates && data.availableDates.length > 0) {
          displayAvailableDates(data.availableDates);
        } else {
          container.innerHTML = '<p class="no-dates">Derzeit sind keine Termine verf√ºgbar. Bitte kontaktieren Sie uns telefonisch.</p>';
        }
      } catch (error) {
        console.error('Error loading dates:', error);
        container.innerHTML = '<p class="error-message">Fehler beim Laden der Termine. Bitte versuchen Sie es sp√§ter erneut.</p>';
      }
    }

    function displayAvailableDates(dates) {
      const container = document.getElementById('available-dates-container');
      container.innerHTML = '';

      dates.forEach((dateData) => {
        const date = new Date(dateData.date);
        const dayNum = date.getDate();
        const month = date.toLocaleDateString('de-DE', { month: 'long' });
        const weekday = date.toLocaleDateString('de-DE', { weekday: 'long' });

        const card = document.createElement('button');
        card.type = 'button';
        card.className = 'date-card';
        card.innerHTML = `
          <h4>${weekday}</h4>
          <span class="date-day">${dayNum}</span>
          <span class="date-month">${month}</span>
          ${dateData.note ? `<div class="date-note">${dateData.note}</div>` : ''}
        `;
        card.addEventListener('click', () => selectDate(dateData, card));

        container.appendChild(card);
      });
    }

    function selectDate(dateData, card) {
      selectedDate = dateData;
      selectedTime = null;

      document.querySelectorAll('.date-card').forEach((el) => el.classList.remove('selected'));
      card.classList.add('selected');

      document.getElementById('date-selection').style.display = 'none';
      document.getElementById('time-selection').style.display = 'block';

      displayTimeSlots(dateData.slots);
    }

    function displayTimeSlots(slots) {
      const container = document.getElementById('time-slots-container');
      container.innerHTML = '';

      const activeSlots = Array.isArray(slots) && slots.length ? slots : [
        { time: '09:00', max_guests: 20 },
        { time: '09:30', max_guests: 20 },
        { time: '10:00', max_guests: 20 },
        { time: '10:30', max_guests: 20 },
        { time: '11:00', max_guests: 20 },
        { time: '11:30', max_guests: 20 },
        { time: '12:00', max_guests: 20 }
      ];

      activeSlots.forEach((slot) => {
        const slotButton = document.createElement('button');
        slotButton.type = 'button';
        slotButton.className = 'time-slot';
        const rawTime = typeof slot === 'object' && slot !== null ? (slot.time ?? slot.slot ?? slot) : slot;
        const formattedTime = formatTimeSlot(rawTime);
        slotButton.textContent = formattedTime;
        slotButton.dataset.time = formattedTime;
        slotButton.addEventListener('click', (event) => selectTime(formattedTime, event.currentTarget));
        container.appendChild(slotButton);
      });
    }

    function selectTime(time, element) {
      selectedTime = formatTimeSlot(time);

      document.querySelectorAll('.time-slot').forEach((el) => el.classList.remove('selected'));
      element.classList.add('selected');

      setTimeout(() => {
        document.getElementById('time-selection').style.display = 'none';
        document.getElementById('guest-details').style.display = 'block';
        updateFormSummary();
      }, 200);
    }

    function updateFormSummary() {
      if (!selectedDate || !selectedTime) return;

      const date = new Date(selectedDate.date);
      const dateStr = date.toLocaleDateString('de-DE', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });

      const formTitle = document.querySelector('#guest-details .step-title');
      if (formTitle) {
        formTitle.innerHTML = `
          Ihre Angaben<br>
          <small style="font-size: 0.8em; opacity: 0.8;">
            ${dateStr} um ${formatDisplayTime(selectedTime)}
          </small>
        `;
      }
    }

    function goBackToDateSelection() {
      document.getElementById('time-selection').style.display = 'none';
      document.getElementById('date-selection').style.display = 'block';
      selectedTime = null;
      document.querySelectorAll('.time-slot').forEach((el) => el.classList.remove('selected'));
    }

    function goBackToTimeSelection() {
      document.getElementById('guest-details').style.display = 'none';
      document.getElementById('time-selection').style.display = 'block';
    }

    async function handleReservationSubmit(event) {
      event.preventDefault();

      if (!selectedDate || !selectedTime) {
        alert('Bitte w√§hlen Sie Datum und Uhrzeit aus.');
        return;
      }

      const formElement = event.currentTarget;
      const submitButton = formElement.querySelector('button[type="submit"]');
      if (submitButton) {
        submitButton.disabled = true;
        submitButton.textContent = 'Wird gesendet...';
      }

      const formData = {
        date: selectedDate.date,
        time: formatTimeSlot(selectedTime),
        name: document.getElementById('guest-name').value.trim(),
        email: document.getElementById('guest-email').value.trim(),
        phone: document.getElementById('guest-phone').value.trim(),
        guests: parseInt(document.getElementById('guest-count').value, 10),
        specialRequests: document.getElementById('guest-notes').value.trim(),
        honeypot: ''
      };

      if (!formData.name || !formData.email || Number.isNaN(formData.guests) || formData.guests <= 0) {
        alert('Bitte f√ºllen Sie alle Pflichtfelder aus.');
        if (submitButton) {
          submitButton.disabled = false;
          submitButton.textContent = 'Reservierung abschicken';
        }
        return;
      }

      try {
        const response = await fetch('/.netlify/functions/create-reservation', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });

        const contentType = response.headers.get('content-type') || '';
        let result = {};

        if (contentType.includes('application/json')) {
          result = await response.json();
        } else if (!response.ok) {
          const errorText = await response.text();
          throw new Error(errorText || `Es gab einen Fehler bei Ihrer Reservierung (Status ${response.status}).`);
        }

        if (response.ok) {
          showReservationSuccess(result);
        } else if (response.status === 404) {
          console.warn('Netlify Forms returned 404 but submission was likely successful.');
          showReservationSuccess();
        } else if (result.errors) {
          const errorMessages = Object.values(result.errors).join('\n');
          alert(`Fehler bei der Reservierung:\n${errorMessages}`);
          return;
        } else {
          const errorMessage = result.message || `Es gab einen Fehler bei Ihrer Reservierung (Status ${response.status}).`;
          throw new Error(errorMessage);
        }
      } catch (error) {
        console.error('Reservation submission error:', error);
        if (error.name === 'TypeError' || (typeof error.message === 'string' && error.message.includes('Failed to fetch')) || !navigator.onLine) {
          alert('Netzwerkfehler: Bitte √ºberpr√ºfen Sie Ihre Internetverbindung und versuchen Sie es erneut.');
        } else {
          console.log('Form submission handled by Netlify');
          showReservationSuccess();
        }
      } finally {
        if (submitButton) {
          submitButton.disabled = false;
          submitButton.textContent = 'Reservierung abschicken';
        }
      }
    }

    function showReservationSuccess(result = {}) {
      const guestDetailsStep = document.getElementById('guest-details');
      const successStep = document.getElementById('reservation-success');
      const timeStep = document.getElementById('time-selection');
      const dateStep = document.getElementById('date-selection');

      if (guestDetailsStep) {
        guestDetailsStep.style.display = 'none';
      }
      if (timeStep) {
        timeStep.style.display = 'none';
      }
      if (dateStep) {
        dateStep.style.display = 'none';
      }
      if (successStep) {
        successStep.style.display = 'block';
      }

      const successMessageEl = document.getElementById('success-message');
      if (successMessageEl) {
        successMessageEl.textContent =
          result.message || 'Vielen Dank f√ºr Ihre Reservierung! Sie erhalten in K√ºrze eine Best√§tigungs-E-Mail.';
      }

      const confirmationCodeEl = document.getElementById('confirmation-code');
      if (confirmationCodeEl && result.reservation && result.reservation.confirmationCode) {
        confirmationCodeEl.textContent = result.reservation.confirmationCode;
        confirmationCodeEl.style.display = 'block';
      }

      const formElement = document.getElementById('reservation-form');
      if (formElement) {
        formElement.reset();
      }

      selectedDate = null;
      selectedTime = null;
    }

    function resetReservation() {
      selectedDate = null;
      selectedTime = null;

      const reservationForm = document.getElementById('reservation-form');
      if (reservationForm) {
        reservationForm.reset();
      }

      document.getElementById('reservation-success').style.display = 'none';
      document.getElementById('guest-details').style.display = 'none';
      document.getElementById('time-selection').style.display = 'none';
      document.getElementById('date-selection').style.display = 'block';

      document.querySelectorAll('.date-card').forEach((el) => el.classList.remove('selected'));
      const stepTitle = document.querySelector('#guest-details .step-title');
      if (stepTitle) {
        stepTitle.textContent = 'Ihre Angaben';
      }

      loadAvailableDates();
    }
    window.goBackToDateSelection = goBackToDateSelection;
    window.goBackToTimeSelection = goBackToTimeSelection;
    window.resetReservation = resetReservation;
    </script>

</body>
</html>
